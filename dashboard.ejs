<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Members list</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback"
    />
    <link rel="stylesheet" href="/plugins/fontawesome-free/css/all.min.css" />
    <!-- <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    /> -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link
      href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/dist/css/adminlte.min.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <style>
      .block-click {
        pointer-events: none;
      }
    </style>

    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f9fafb;
        color: #222;
      }

      h1,
      h3 {
        font-weight: 600;
      }
    </style>

    <style>
      /* Base layout */
      html,
      body,
      .wrapper,
      .content-wrapper {
        background-color: #3b0840 !important;
        color: #ffffff !important;
      }

      .content-header h1 i,
      .content-header h1,
      h3.content-header {
        color: #347ddb !important;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f9fafb;
        color: #222;
      }

      .content-wrapper {
        background-color: #ffffff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      }

      /* Header section */
      h1.font {
        font-size: 2rem;
        color: #2b0057;
        margin-bottom: 8px;
      }

      h1.font i {
        color: #4b0082;
      }

      .text-muted {
        color: #6c757d !important;
      }

      /* Dashboard container */
      .wrap {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2b0057;
      }

      .subtitle {
        font-size: 0.9rem;
        color: #6c757d;
      }

      .muted {
        color: #6c757d;
        font-size: 0.9rem;
      }

      /* Card grid layout */
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 20px;
      }

      /* Card styling */
      .card {
        background-color: #2c162e;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 6px 15px rgba(75, 0, 130, 0.08);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(75, 0, 130, 0.12);
      }

      .card .label {
        font-size: 0.95rem;
        color: #4b0082;
        font-weight: 600;
      }

      .card .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2b0057;
        margin-top: 8px;
      }

      .card .label,
      .card .value {
        color: #b5bdc5 !important;
      }

      .card .value--blue {
        color: #4b0082;
      }

      .card .value--green {
        color: #1aa05b;
      }

      .card .small {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 6px;
      }

      /* Responsive behavior */
      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .grid {
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .card .value {
          font-size: 1.25rem;
        }
      }
    </style>
  </head>

  <body class="hold-transition sidebar-mini">
    <div class="wrapper">
      <%- include('nav') %>
      <div class="content-wrapper">
        <section class="content-header">
          <section class="text-center">
            <h1 class="font">
              <i class="fa-solid fa-chart-line" style="margin-right: 1%"></i>Hi,
              Mr DigiSlay
            </h1>
            <p class="text-muted" style="color: #b5bdc5 !important">
              View and track all your data in one place.
            </p>
          </section>
          <!-- /.container-fluid -->
        </section>

        <!-- <div class="form-group" style="text-align: center">
          <input
            type="text"
            id="search"
            placeholder="Enter the member you are looking for"
          />
        </div> -->

        <!-- Main content -->
        <div class="wrap">
          <div class="header">
            <div>
              <h3 class="content-header">Admin Dashboard</h3>
              <div class="subtitle" style="color: #b5bdc5 !important">
                Performance Summary — daily stats and totals.
              </div>
            </div>
          </div>

          <div class="grid" id="cards">
            <div
              id="loader"
              style="color: #347ddb !important; font-weight: 700"
            >
              Loading...
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/dist/js/adminlte.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script src="/js/admin/admin.js"></script>
    <script>
      const container = document.getElementById("cards");
      const loader = document.getElementById("loader");
      function formatINR(num) {
        num = Number(num) || 0;
        return num.toLocaleString("en-IN", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      }

      // ✅ define all card names here
      const cardNames = [
        "Total Users",
        "Active Users",
        "Blocked Users",
        "Today User Join",
        "Today's Recharge",
        "Today's Withdrawal",
        "Total Recharge",
        "Total Withdrawal",
        "Today's total bet",
        "Today's total win",
        "Today's total loss",
        "Today's profit",
        "Total bet",
        "Wins",
        "Losses",
        "Profit",
      ];

      async function loadDashboard() {
        try {
          const res = await fetch("/api/admin/fetch-dashboard-data", {
            method: "GET",
            credentials: "include",
          });

          const data = await res.json();
          console.log(data);

          if (!data.status) {
            Swal.fire("Error", "Unauthorized or failed to fetch data", "error");
            return;
          }

          // mapping API values
          const values = {
            "Total Users": data.totalUsers ?? 0,
            "Active Users": data.activeUsers,
            "Blocked Users": data.blockedUsers,
            "Today User Join": data.todayUsers ?? 0,
            "Today's Recharge": formatINR(data.todayRecharge ?? 0),
            "Today's Withdrawal": formatINR(data.todayWithdraws ?? 0),
            "Total Recharge": formatINR(data.recharges ?? 0),
            "Total Withdrawal": formatINR(data.withdraws ?? 0),
            "Today's total bet": formatINR(data.todayWin + data.todayLoss ?? 0),
            "Today's total win": formatINR(data.todayWin ?? 0),
            "Today's total loss": formatINR(data.todayLoss ?? 0),
            "Today's profit": formatINR(data.todayWin - data.todayLoss ?? 0),
            "Total bet": formatINR(data.win + data.loss ?? 0),
            Wins: formatINR(data.win),
            Losses: formatINR(data.loss),
            Profit: formatINR(data.win - data.loss ?? 0),
          };

          // clear container
          container.innerHTML = "";
          loader.style.display = "none";

          // build cards
          cardNames.forEach((name) => {
            const card = document.createElement("div");
            card.className = "card";

            const label = document.createElement("div");
            label.className = "label";
            label.textContent = name;

            const value = document.createElement("div");
            value.className = "value";
            value.textContent = values[name];

            card.appendChild(label);
            card.appendChild(value);

            container.appendChild(card);
          });
          loader.style.display = "none";
        } catch (err) {
          console.error(err);
          Swal.fire("Error", "Could not load dashboard", "error");
        }
      }

      loadDashboard();
    </script>
  </body>
</html>
