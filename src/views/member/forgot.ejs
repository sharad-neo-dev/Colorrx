<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password | colorrx</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'app-bg': '#0b0c1a',
                        'app-purple': '#3e1474',
                    }
                }
            }
        }
    </script>

    <!-- Remixicon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Toastify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>

<body class="bg-app-bg min-h-screen w-full md:max-w-[500px] mx-auto pb-24">

    <!-- Header -->
    <div class="sticky top-0 z-10 flex items-center h-14 px-2" style="background: linear-gradient(180deg, #3e1474, #101114 96.35%);">
        <button onclick="history.back()" aria-label="Back" class="text-white pr-4 text-lg">
      <i class="ri-arrow-left-s-line w-6 h-auto"></i>
    </button>
        <h2 class="flex-1 text-center text-white font-semibold text-lg">Forgot Password</h2>
        <span class="w-6"></span>
    </div>

    <!-- Password Form -->
    <div class="px-4 mt-6 space-y-6">
        <!-- Current Password -->
        <div class="relative">
            <input id="password" type="password" placeholder="Enter current password" class="w-full px-4 py-3 text-lg bg-[#23222b] text-white rounded focus:outline-none focus:ring-2 focus:ring-purple-600" />
            <span class="absolute right-4 top-3 text-white cursor-pointer toggle-password" data-target="password">
        <i class="ri-eye-line"></i>
      </span>
            <p id="passwordError" class="text-red-500 text-sm mt-1 hidden"></p>
        </div>

        <!-- New Password -->
        <div class="relative">
            <input id="newPassWord" type="password" placeholder="Enter new password" class="w-full px-4 py-3 text-lg bg-[#23222b] text-white rounded focus:outline-none focus:ring-2 focus:ring-purple-600" />
            <span class="absolute right-4 top-3 text-white cursor-pointer toggle-password" data-target="newPassWord">
        <i class="ri-eye-line"></i>
      </span>
            <p id="newPasswordError" class="text-red-500 text-sm mt-1 hidden"></p>
        </div>

        <!-- Confirm New Password -->
        <div class="relative">
            <input id="RePassWord" type="password" placeholder="Confirm new password" class="w-full px-4 py-3 text-lg bg-[#23222b] text-white rounded focus:outline-none focus:ring-2 focus:ring-purple-600" />
            <span class="absolute right-4 top-3 text-white cursor-pointer toggle-password" data-target="RePassWord">
        <i class="ri-eye-line"></i>
      </span>
            <p id="confirmPasswordError" class="text-red-500 text-sm mt-1 hidden"></p>
        </div>

        <!-- Submit Button -->
        <button id="submit" class="w-full bg-app-purple text-white py-3 rounded-lg font-semibold text-lg hover:bg-purple-800 flex items-center justify-center gap-2">
      <span class="btn-text">Reset Password</span>
      <span class="btn-loader hidden animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"></span>
    </button>
    </div>

    <!-- Footer include (if EJS used) -->
    <%- include('../layout/footer.ejs') %>

        <script>
            // Show/hide password toggle
            $(".toggle-password").on("click", function() {
                const targetId = $(this).data("target");
                const input = $("#" + targetId);
                const icon = $(this).find("i");

                if (input.attr("type") === "password") {
                    input.attr("type", "text");
                    icon.removeClass("ri-eye-line").addClass("ri-eye-off-line");
                } else {
                    input.attr("type", "password");
                    icon.removeClass("ri-eye-off-line").addClass("ri-eye-line");
                }
            });

            // Toastify wrapper
            function showToast(message, type = "success") {
                Toastify({
                    text: message,
                    duration: 3000,
                    close: true,
                    gravity: "top",
                    position: "center",
                    backgroundColor: type === "success" ? "#4ade80" : "#f87171",
                    stopOnFocus: true
                }).showToast();
            }

            // Submit handler
            $("#submit").click(function(e) {
                e.preventDefault();

                const password = $("#password").val().trim();
                const newPassWord = $("#newPassWord").val().trim();
                const RePassWord = $("#RePassWord").val().trim();

                // Reset errors
                $(".text-red-500").addClass("hidden").text("");

                if (!password || !newPassWord || !RePassWord) {
                    showToast("Please enter all required information", "error");
                    return;
                }

                if (newPassWord.length < 6) {
                    $("#newPasswordError").removeClass("hidden").text("Password must be at least 6 characters.");
                    return;
                }

                if (newPassWord !== RePassWord) {
                    $("#confirmPasswordError").removeClass("hidden").text("Passwords do not match.");
                    return;
                }

                // Show loader
                $(".btn-text").addClass("hidden");
                $(".btn-loader").removeClass("hidden");

                $.ajax({
                    type: "PUT",
                    url: "/api/webapi/change/pass",
                    data: {
                        password,
                        newPassWord,
                        RePassWord
                    },
                    dataType: "json",
                    success: function(response) {
                        const data = response || {};
                        showToast(data.message || "Password update failed", data.status ? "success" : "error");

                        if (data.status) {
                            $("#password, #newPassWord, #RePassWord").val("");
                            setTimeout(() => history.back(), 1500);
                        }
                    },
                    error: function() {
                        showToast("An error occurred. Please try again.", "error");
                    },
                    complete: function() {
                        // Hide loader
                        $(".btn-text").removeClass("hidden");
                        $(".btn-loader").addClass("hidden");
                    }
                });
            });
        </script>
</body>

</html>