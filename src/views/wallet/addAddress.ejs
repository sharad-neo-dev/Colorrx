<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add USDT Address | colorrx</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <style>
        .bg-gradient-header {
            background: linear-gradient(180deg, #3e1474, #101114 96.35%);
        }

        /* Custom styles for the message alert (used in the original JS) */
        .message_alert_root {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .message_alert_text {
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 5px;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .message_alert_root .message_alert_text {
            opacity: 1;
        }
    </style>
</head>

<body class="bg-[#0e0d2a] text-white min-h-screen font-sans w-full md:max-w-[500px] mx-auto">

    <header class="flex items-center h-14 px-4 bg-gradient-header sticky top-0 z-10">
        <button onclick="history.back()" aria-label="Back" class="text-white text-xl">
            <i class="ri-arrow-left-s-line"></i>
        </button>
        <h2 class="flex-1 text-center text-white font-bold text-lg">Add USDT address</h2>
        <div class="w-8"></div> </header>

    <div class="mx-4 mt-4 p-3 rounded-xl text-sm text-[#ff4b2b] bg-[#3e1474] flex items-center shadow-lg">
        <i class="ri-error-warning-fill mr-2 text-xl"></i>
        <span>To ensure the safety of your funds, please link your wallet</span>
    </div>

    <div class="p-4 space-y-4">

        <div class="relative bg-[#292757] rounded-xl flex items-center px-3 py-3 shadow-md border border-[#b1835a]">
            <i class="ri-gallery-line text-xl mr-3 text-gray-400"></i>
            <select id="main_network_select"
                class="w-full bg-transparent text-white focus:outline-none appearance-none cursor-pointer text-sm font-semibold">
                <option value="TRC" class="bg-[#292757] text-white" selected>TRC</option>
                </select>
            <i class="ri-arrow-down-s-line absolute right-3 text-gray-400 pointer-events-none"></i>
        </div>

        <div class="relative bg-[#292757] rounded-xl flex items-center px-3 py-3 shadow-md">
            <i class="ri-money-dollar-circle-line text-xl mr-3 text-gray-400"></i>
            <input type="text" placeholder="USDT Address"
                class="w-full bg-transparent text-white placeholder-gray-400 focus:outline-none text-sm" />
        </div>

        <div class="relative bg-[#292757] rounded-xl flex items-center px-3 py-3 shadow-md">
            <i class="ri-fingerprint-line text-xl mr-3 text-gray-400"></i>
            <input type="text" placeholder="Address Alias (e.g., My Wallet)"
                class="w-full bg-transparent text-white placeholder-gray-400 focus:outline-none text-sm" />
        </div>

        <div class="pt-4">
            <button id="submit_button"
             style="background: linear-gradient(180deg, #3e1474, #101114 96.35%);"
                class="w-full py-3 rounded-xl text-white font-semibold hover:opacity-90 transition shadow-lg">
                Save
            </button>
        </div>

    </div>
 <%- include('../layout/footer.ejs') %>
    <script>
        // Use Toastify for alerts in the new UI style
        function showToast(message, type = "info") {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "center",
                backgroundColor: type === "success"
                    ? "linear-gradient(to right, #00b09b, #96c93d)"
                    : "linear-gradient(to right, #ff416c, #ff4b2b)",
            }).showToast();
        }

        // Replaced original alertMessage function with a simple wrapper for showToast
        const alertMessage = text => {
            showToast(text, "error");
        };

        /**
         * Fetches existing USDT address data and pre-fills the input fields.
         */
        const initPreviousValues = async () => {
            try {
                const response = await axios({
                    method: "GET",
                    url: "/api/webapi/withdraw/usdt_address",
                })

                if (response?.data?.account?.isAvailable) {
                    // Pre-fill input fields based on their order in the HTML
                    // 0: usdtAddress, 1: addressAlias
                    $('input:eq(0)').val(response?.data?.account?.usdtAddress)
                    $('input:eq(1)').val(response?.data?.account?.addressAlias)
                }
            } catch (error) {
                console.error("Error fetching previous USDT details:", error);
                // Optionally show a non-critical toast if fetching fails
            }
        }
        // Run on page load
        initPreviousValues()

        /**
         * Handles the form submission to save the USDT address.
         */
        $('#submit_button').click(async function (e) {
            try {
                e.preventDefault();

                // Retrieve values from the UI
                const mainNetwork = $('#main_network_select').val(); // Gets the selected value, e.g., 'TRC'
                let usdtAddress = $('input:eq(0)').val().trim();
                let addressAlias = $('input:eq(1)').val().trim();

                // Basic validation
                if (usdtAddress && addressAlias && mainNetwork) {
                    const response = await axios({
                        method: "POST",
                        url: "/api/webapi/withdraw/add_usdt_address",
                        data: {
                            mainNetwork, // Using the selected network
                            usdtAddress,
                            addressAlias
                        }
                    })

                    showToast(response.data.message || "USDT Address saved successfully!", "success");
                    setTimeout(() => {
                        window.location.href = "/wallet/withdrawal";
                    }, 1200);
                } else {
                    alertMessage('Please enter full information');
                }
            } catch (error) {
                console.error("Error submitting USDT address:", error);
                const message = error?.response?.data?.message || "Something went wrong! Please try again.";
                alertMessage(message);
            }
        });
    </script>
</body>

</html>