<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promotion Page | colorrx</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="bg-[#11131f] text-white min-h-screen w-full md:max-w-[500px] mx-auto">


    <%- include('../layout/header.ejs') %>

        <!-- Loading overlay -->
        <div class="ar-loading-view fixed inset-0 z-50 flex items-center justify-center" style="display:none;">
            <div class="flex flex-col items-center gap-2">
                <svg class="animate-spin h-10 w-10" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
                <div class="text-sm text-gray-300">Loading...</div>
            </div>
        </div>

        <!-- Commission Summary -->
        <div class="relative rounded-b-3xl shadow-lg overflow-hidden">
            <div class="absolute inset-0">
                <img src="/assets/png/promotionbg-13880556 (1).png" alt="Promotion Background" class="w-full h-full object-cover" />
                <div class="absolute inset-0 bg-black/40"></div>
            </div>
            <div class="relative z-10 p-6 text-white">
                <h2 id="yesterdayCommissionAmount" class="text-3xl font-bold text-center">0</h2>
                <p class="text-sm text-center mt-1">Yesterday's total commission</p>
                <p class="text-xs text-center mt-1 opacity-90">Upgrade the level to increase commission income</p>

                <!-- Subordinates -->
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="bg-[#3e1474]/70 backdrop-blur-sm rounded-xl p-4 text-center">
                        <h3 class="font-semibold">Direct subordinates</h3>
                        <p class="text-xs mt-1">Registered: <span id="noOfRegisteredSubordinates">0</span></p>
                        <p class="text-xs">Deposit number: <span id="directSubordinatesRechargeQuantity">0</span></p>
                        <p class="text-xs">Deposit amount: <span id="directSubordinatesRechargeAmount">0</span></p>
                        <p class="text-xs">First deposit count: <span id="directSubordinatesWithDepositCount">0</span></p>
                    </div>
                    <div class="bg-[#3e1474]/70 backdrop-blur-sm rounded-xl p-4 text-center">
                        <h3 class="font-semibold">Team subordinates</h3>
                        <p class="text-xs mt-1">Team count: <span id="teamSubordinatesCount">0</span></p>
                        <p class="text-xs">Registered in team: <span id="noOfRegisterAllSubordinates">0</span></p>
                        <p class="text-xs">Team deposit number: <span id="teamSubordinatesRechargeQuantity">0</span></p>
                        <p class="text-xs">Team deposit amount: <span id="teamSubordinatesRechargeAmount">0</span></p>
                        <p class="text-xs">Team first deposit: <span id="teamSubordinatesWithDepositCount">0</span></p>
                    </div>
                </div>

                <!-- Invitation Link -->
                <div class="mt-6">
                    <button id="invitation_link_btn" class="shareBtnContainer w-full py-2 rounded-full bg-white text-[#3e1474] font-semibold shadow">
          INVITATION LINK
        </button>
                </div>
            </div>
        </div>

        <!-- Menu -->
        <div class="p-4 space-y-4">
            <div class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md">
                <div class="flex items-center gap-3">
                    <i class="ri-file-copy-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Copy invitation code</span>
                </div>
                <div class="flex items-center gap-2">
                    <span id="invitation_code_display" class="text-xs text-gray-300">812687849751</span>
                    <button id="invitation_code_copy_btn" class="ml-2 text-xs px-2 py-1 rounded bg-white/10">Copy</button>
                </div>
            </div>

            <a href="/promotion/myTeam" class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md cursor-pointer">
                <div class="flex items-center gap-3">
                    <i class="ri-user-add-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Subordinate data</span>
                </div>
                <i class="ri-arrow-right-s-line text-gray-300"></i>
            </a>

            <a href="/promotion/promotionDes" class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md cursor-pointer">
                <div class="flex items-center gap-3">
                    <i class="ri-money-dollar-circle-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Commission detail</span>
                </div>
                <i class="ri-arrow-right-s-line text-gray-300"></i>
            </a>

            <a href="promotion/tutorial" class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md cursor-pointer">
                <div class="flex items-center gap-3">
                    <i class="ri-book-open-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Invitation rules</span>
                </div>
                <i class="ri-arrow-right-s-line text-gray-300"></i>
            </a>

            <a href="#" class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md cursor-pointer">
                <div class="flex items-center gap-3">
                    <i class="ri-customer-service-2-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Agent line customer service</span>
                </div>
                <i class="ri-arrow-right-s-line text-gray-300"></i>
            </a>

            <a href="/promotion/rebateRadio" class="flex justify-between items-center p-3 bg-[#3e1474] rounded-xl shadow-md cursor-pointer">
                <div class="flex items-center gap-3">
                    <i class="ri-percent-line text-pink-400 text-xl"></i>
                    <span class="text-sm font-medium">Rebate ratio</span>
                </div>
                <i class="ri-arrow-right-s-line text-gray-300"></i>
            </a>

        </div>

        <!-- Promotion Data -->
        <div class="p-6 bg-[#3e1474] shadow-md rounded-2xl m-4 mb-[7rem]">
            <h3 class="text-pink-400 font-semibold mb-4">promotion data</h3>
            <div class="grid grid-cols-2 sm:grid-cols-4 text-center gap-4">
                <div>
                    <p id="totalCommissionsThisWeek" class="text-lg font-bold">0</p>
                    <p class="text-xs text-gray-300">This Week</p>
                </div>
                <div>
                    <p id="totalCommissions" class="text-lg font-bold">0</p>
                    <p class="text-xs text-gray-300">Total commission</p>
                </div>
                <div>
                    <p id="directSubordinatesCount" class="text-lg font-bold">0</p>
                    <p class="text-xs text-gray-300">direct subordinate</p>
                </div>
                <div>
                    <p id="noOfRegisterAllSubordinates" class="text-lg font-bold">0</p>
                    <p class="text-xs text-gray-300">Total team subordinates</p>
                </div>
            </div>
        </div>

        <%- include('../layout/footer.ejs') %>

            <!-- Libs -->
            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

            <script>
                $(".ar-loading-view").fadeIn();

                var userData = null;
                var userInfoTypes = {
                    referCode: "code"
                };

                function getData(response) {
                    if (response && response.data) {
                        if (response.data.data) return response.data.data;
                        return response.data;
                    }
                    return null;
                }

                function fetchUser() {
                    return axios.get("/api/webapi/GetUserInfo")
                        .then(function(res) {
                            userData = getData(res);
                            return userData;
                        })
                        .catch(function(err) {
                            console.log("fetchUser error", err);
                            return null;
                        });
                }

                function setUserInfoDisplay(idName, userInfoType) {
                    var el = document.getElementById(idName);
                    if (!el) return;
                    el.textContent = "Loading...";
                    if (userData && userData[userInfoType]) {
                        el.textContent = userData[userInfoType];
                    } else {
                        el.textContent = "";
                    }
                }

                function alertMessage(text) {
                    var msg = document.createElement("div");
                    msg.className = "fixed left-1/2 -translate-x-1/2 bottom-8 z-50 px-4 py-2 rounded-lg bg-white/10 text-white shadow backdrop-blur";
                    msg.textContent = text;
                    document.body.appendChild(msg);
                    setTimeout(function() {
                        msg.style.transition = "opacity 200ms";
                        msg.style.opacity = "0";
                        setTimeout(function() {
                            if (msg.parentElement) msg.parentElement.removeChild(msg);
                        }, 250);
                    }, 1100);
                }

                $("#invitation_code_copy_btn").click(function(e) {
                    e.preventDefault();
                    var code = (userData && userData[userInfoTypes.referCode]) || document.getElementById("invitation_code_display").textContent;
                    if (!code) {
                        alertMessage("No code");
                        return;
                    }
                    navigator.clipboard.writeText(code).then(function() {
                        alertMessage("Copy successful");
                    }).catch(function() {
                        alertMessage("Copy failed");
                    });
                });

                $(".shareBtnContainer").click(function(e) {
                    e.preventDefault();
                    var code = (userData && userData[userInfoTypes.referCode]) || "";
                    var invitationLink = window.location.origin + "/register?invitationCode=" + encodeURIComponent(code);

                    if (navigator.share) {
                        navigator.share({
                            title: document.title,
                            text: "Invite your friends from this link!",
                            url: invitationLink
                        }).then(function() {
                            alertMessage("Share opened");
                        }).catch(function() {
                            alertMessage("Share failed");
                        });
                    } else {
                        navigator.clipboard.writeText(invitationLink).then(function() {
                            alertMessage("Link copied");
                        }).catch(function() {
                            alertMessage("Copy failed");
                        });
                    }
                });

                function initSubordinatesData() {
                    axios.get("/api/subordinates/summary")
                        .then(function(res) {
                            var data = getData(res) || {};
                            $("#directSubordinatesCount").text(data.directSubordinatesCount || 0);
                            $("#noOfRegisteredSubordinates").text(data.noOfRegisteredSubordinates || 0);
                            $("#directSubordinatesRechargeQuantity").text(data.directSubordinatesRechargeQuantity || 0);
                            $("#directSubordinatesRechargeAmount").text(data.directSubordinatesRechargeAmount || 0);
                            $("#directSubordinatesWithDepositCount").text(data.directSubordinatesWithDepositCount || 0);

                            $("#teamSubordinatesCount").text(data.teamSubordinatesCount || 0);
                            $("#noOfRegisterAllSubordinates").text(data.noOfRegisterAllSubordinates || 0);
                            $("#teamSubordinatesRechargeQuantity").text(data.teamSubordinatesRechargeQuantity || 0);
                            $("#teamSubordinatesRechargeAmount").text(data.teamSubordinatesRechargeAmount || 0);
                            $("#teamSubordinatesWithDepositCount").text(data.teamSubordinatesWithDepositCount || 0);

                            $("#totalCommissionsThisWeek").text(data.totalCommissionsThisWeek || 0);
                            $("#totalCommissions").text(data.totalCommissions || 0);
                            $("#yesterdayCommissionAmount").text(data.totalCommissionsYesterday || 0);
                        })
                        .catch(function(err) {
                            console.log("initSubordinatesData error", err);
                        })
                        .finally(function() {
                            $(".ar-loading-view").fadeOut();
                        });
                }

                $(document).ready(function() {
                    fetchUser().then(function() {
                        setUserInfoDisplay("invitation_code_display", userInfoTypes.referCode);
                        initSubordinatesData();
                    });
                });
            </script>
</body>

</html>